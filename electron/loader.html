<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Iduej - Loader</title>
<style>
body {
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100%;
  font-family:sans-serif;
  background:transparent;
  color: #333;
}

img {
  width: 120px;
  margin-bottom: 20px;
}

.loader {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
  border: 4px solid #0000;
  border-radius: 50%;
  border-color: #ccc #0000;
  animation: l16 1s infinite linear;
  margin-bottom: 20px;
}
.loader::before,
.loader::after {    
  content: "";
  grid-area: 1/1;
  margin: 2px;
  border: inherit;
  border-radius: 50%;
}
.loader::before {
  border-color: #f03355 #0000;
  animation: inherit; 
  animation-duration: .5s;
  animation-direction: reverse;
}
.loader::after {
  margin: 8px;
}
@keyframes l16 { 
  100%{transform: rotate(1turn)}
}

#progress-container {
  width: 80%;
  height: 20px;
  background: #ccc;
  border-radius: 10px;
  overflow: hidden;
  display: none; /* cachée par défaut */
}
#progress-bar {
  width: 0%;
  height: 100%;
  background: #4CAF50;
  transition: width 0.2s;
}
</style>
</head>
<body>

<img src="resources/icon.png" alt="Logo">
<div class="loader" id="spinner"></div>

<div id="progress-container">
  <div id="progress-bar"></div>
</div>

<script>
const spinner = document.getElementById("spinner");
const progressContainer = document.getElementById("progress-container");
const progressBar = document.getElementById("progress-bar");

// spinner minimum visible 10s
const MIN_LOADER_TIME = 10000;
let loaderTimeout = setTimeout(() => {
  window.loaderReady = true;
}, MIN_LOADER_TIME);

// AutoUpdater events
window.electronAPI.onUpdateAvailable(() => {
  // si spinner encore visible → attendre fin du min loader
  Promise.resolve().then(() => {
    const wait = window.loaderReady ? 0 : MIN_LOADER_TIME;
    setTimeout(() => {
      spinner.style.display = "none";
      progressContainer.style.display = "block";
    }, wait);
  });
});

window.electronAPI.onDownloadProgress((percent) => {
  progressBar.style.width = percent + "%";
});
</script>

</body>
</html>
