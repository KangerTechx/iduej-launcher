<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Iduej - Loader</title>
<link href="https://fonts.googleapis.com/css2?family=Matemasie:wght@400;700&display=swap" rel="stylesheet"></link>
<style>
body {
  display:flex;
  border: 4px solid #2c2c2c;
  border-radius: 40px;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  width: 400px;
  height:300px;
  font-family:sans-serif;
  background:#010013;
  color: #333;
}

img {
  width: 120px;
  margin-bottom: 10px;
}

h1 {
  font-family: 'Matemasie', sans-serif;
  font-size: 24px ;
  line-height: 1.333333;
  color: #fff;
  margin-bottom: 50px;
}

h1 span {
  color : #2463eb;
}

.loader {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
  border: 4px solid #0000;
  border-radius: 50%;
  border-color: #ccc #0000;
  animation: l16 1s infinite linear;
  margin-bottom: 20px;
}
.loader::before,
.loader::after {    
  content: "";
  grid-area: 1/1;
  margin: 2px;
  border: inherit;
  border-radius: 50%;
}
.loader::before {
  border-color:  #0000 #2463eb;
  animation: inherit; 
  animation-duration: .5s;
  animation-direction: reverse;
}
.loader::after {
  margin: 8px;
}
@keyframes l16 { 
  100%{transform: rotate(1turn)}
}

#progressBar-container {
  display: none;
  width: 100%;
  flex-direction: column;
  align-items: center;
}

#progress-container {
  width: 80%;
  height: 20px;
  border: 1px solid #fff;
  background: transparent;
  border-radius: 10px;
  overflow: hidden;
}

#progress-percent {
  text-align: right;
  font-size: 12px;
  color: #fff;
}

#progress-bar {
  width: 0%;
  height: 100%;
  background: #2463eb;
  transition: width 0.2s;
}
</style>
</head>
<body>

<img src="resources/logo.png" alt="Logo">
<h1><span>I</span>due<span>j</span></h1>
<div class="loader" id="spinner"></div>

<div id="progressBar-container">
  <p id="progress-percent"></p>
  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>
</div>

<script>
const spinner = document.getElementById("spinner");
const progressBarContainer = document.getElementById("progressBar-container");
const progressBar = document.getElementById("progress-bar");
const progressPercent = document.getElementById("progress-percent");

// spinner minimum visible 10s
const MIN_LOADER_TIME = 10000;
let loaderTimeout = setTimeout(() => {
  window.loaderReady = true;
}, MIN_LOADER_TIME);

// AutoUpdater events
window.electronAPI.onUpdateAvailable(() => {
  // si spinner encore visible â†’ attendre fin du min loader
  Promise.resolve().then(() => {
    const wait = window.loaderReady ? 0 : MIN_LOADER_TIME;
    setTimeout(() => {
      spinner.style.display = "none";
      progressBarContainer.style.display = "flex";
    }, wait);
  });
});

window.electronAPI.onDownloadProgress((percent) => {
  progressBar.style.width = percent + "%";

  progressPercent.textContent(percent + " %")
});
</script>

</body>
</html>
